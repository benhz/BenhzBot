# 环境变量配置示例
# 使用方法：复制此文件为 .env（注意开头的点）

# ========================================
# 钉钉配置（必需）
# ========================================
# 从钉钉开放平台获取：https://open.dingtalk.com
DINGTALK_APP_KEY=your_app_key
DINGTALK_APP_SECRET=your_app_secret
DINGTALK_AGENT_ID=your_agent_id
DINGTALK_ROBOT_CODE=your_robot_code

# ========================================
# 数据库配置
# ========================================
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=postgres
DB_NAME=dingteam_bot
DB_SSLMODE=disable

# ========================================
# 服务配置
# ========================================
SERVER_PORT=8080
TIMEZONE=Asia/Shanghai

# ========================================
# 管理员白名单（必需）
# ========================================
# 逗号分隔的钉钉 UserID（员工 ID）
# 这里配置的用户将在系统启动时自动初始化为超级管理员（super_admin）
# 超级管理员拥有所有权限，包括添加/移除其他管理员
# 示例：ADMIN_USERS=user123,user456,user789
ADMIN_USERS=user123,user456

# ========================================
# Dify AI 集成（可选）
# ========================================
# 是否启用 Dify 智能对话功能
# 设置为 true 时，机器人将使用 Dify AI 理解用户意图
# 设置为 false 或不设置时，使用传统命令匹配模式
DIFY_ENABLED=false

# Dify API Key
# 从 Dify 平台获取：https://cloud.dify.ai
# 格式：app-xxxxxxxxxxxxxxxxxxxxxxxx
DIFY_API_KEY=your_dify_api_key

# Dify Webhook URL（工作流 API）
# 工作流格式：https://api.dify.ai/v1/workflows/run
# 或自建 Dify 服务的 URL：http://localhost:5001/v1/workflows/run
# 注意：本系统使用工作流 API，不是对话应用 API
DIFY_WEBHOOK_URL=http://localhost:5001/v1/workflows/run


# ========================================
# 配置说明
# ========================================

## 如何获取钉钉凭证？
# 1. 登录钉钉开放平台：https://open.dingtalk.com
# 2. 进入"应用开发" → "企业内部开发" → "创建应用"
# 3. 开启"机器人"能力
# 4. 在"应用信息"中获取：
#    - AppKey
#    - AppSecret
# 5. 在"机器人设置"中获取：
#    - RobotCode
# 6. 在"应用管理"中获取：
#    - AgentID

## 如何获取管理员 UserID？
# 方法1：在钉钉管理后台查看员工信息
# 方法2：机器人日志中可以看到发送消息的用户 ID
# 方法3：调用钉钉 API：https://oapi.dingtalk.com/topapi/v2/user/get

## 权限系统说明
# 系统有三种角色：
# 1. super_admin（超级管理员）- 拥有所有权限，通过 ADMIN_USERS 配置
# 2. admin（子管理员）- 可管理任务，由超级管理员授予
# 3. member（普通成员）- 仅可打卡和查看
#
# 启动流程：
# 1. 配置 ADMIN_USERS 环境变量（至少一个用户）
# 2. 启动服务，系统自动将这些用户设为 super_admin
# 3. 超级管理员可通过命令添加其他子管理员：
#    @机器人 添加管理员 @用户
# 4. 查看当前权限：@机器人 我的权限

## 如何配置 Dify AI？
# 1. 注册 Dify 账号：https://cloud.dify.ai（或部署自建服务）
# 2. 创建工作流应用：
#    - 选择"工作流"类型（Workflow）
#    - 配置工作流输入变量：
#      * user_input（文本）- 用户输入的消息内容
#      * conversation_id（文本）- 钉钉会话 ID
#    - 配置工作流输出：确保至少有一个文本类型的输出字段（如 reply, text, answer 等）
# 3. 获取 API Key：
#    - 进入应用设置 → API 管理
#    - 创建 API Key（格式：app-xxxxxxxxxxxxxxxxxxxxxxxx）
# 4. 配置工具（Tools）：
#    - 添加 HTTP 请求工具
#    - 配置后台 API 端点：
#      * POST /api/v1/dify/execute - 执行操作
#      * POST /api/v1/dify/send_message - 发送消息
# 5. 设置环境变量：
#    - DIFY_ENABLED=true
#    - DIFY_API_KEY=你的API Key
#    - DIFY_WEBHOOK_URL=http://localhost:5001/v1/workflows/run（或云端地址）
#
# 注意事项：
# - 本系统使用 Dify 工作流 API（/v1/workflows/run），不是对话应用 API
# - 工作流必须配置 user_input 和 conversation_id 两个输入变量
# - 工作流的输出会自动提取第一个非空字符串字段作为回复

## 注意事项
# 1. 此文件包含敏感信息，不要提交到 Git 仓库
# 2. .gitignore 已配置忽略 .env 文件
# 3. 生产环境建议使用 Kubernetes Secret 管理敏感信息
# 4. 修改配置后需要重启服务才能生效
# 5. Dify 集成是可选功能，不配置也可使用传统命令模式